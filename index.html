<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Oslune · Home Automation</title>

<link rel="icon" type="image/png" href="logo.png">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600;14..32,700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<style>
*{margin:0;padding:0;box-sizing:border-box;}

body{
font-family:'Inter',sans-serif;
background:radial-gradient(circle at 40% 30%,#131a26,#0b101a 80%,#040810);
min-height:100vh;
display:flex;
align-items:center;
justify-content:center;
color:white;
}

.dashboard{width:100%;max-width:380px;}

.device-card{
background:rgba(18,24,34,.6);
backdrop-filter:blur(22px);
border-radius:44px;
padding:36px 28px 42px;
box-shadow:0 30px 50px -20px rgba(0,0,0,.9);
display:flex;
flex-direction:column;
align-items:center;
text-align:center;
}

.device-header{
display:flex;
align-items:center;
gap:12px;
margin-bottom:10px;
}

.logo-container{
width:50px;height:50px;border-radius:50%;overflow:hidden;
border:2px solid rgba(255,255,255,.2);
}

.logo-container img{width:100%;height:100%;object-fit:cover;}

.device-name{
font-weight:700;
font-size:2.2rem;
background:linear-gradient(145deg,#fff,#c4ddff);
-webkit-background-clip:text;
color:transparent;
}

.device-status{
margin:20px 0;
padding:8px 22px;
border-radius:60px;
background:rgba(255,255,255,.06);
}

.toggle-wrapper{margin:20px 0;}

#deviceToggle{display:none;}

.toggle-switch{
display:inline-block;
width:120px;height:62px;
background:#333;
border-radius:44px;
position:relative;
cursor:pointer;
}

.toggle-switch::after{
content:'';
width:54px;height:54px;
background:white;
border-radius:50%;
position:absolute;
top:4px;left:4px;
transition:.4s;
}

#deviceToggle:checked + .toggle-switch{
background:#1fe070;
}

#deviceToggle:checked + .toggle-switch::after{
transform:translateX(58px);
}

.cloud-badge{
margin-top:20px;
font-size:.8rem;
opacity:.8;
}
</style>
</head>

<body>

<div class="dashboard">
<div class="device-card">

<div class="device-header">
<div class="logo-container">
<img src="logo.png">
</div>
<div class="device-name">ANIQUE</div>
</div>

<div class="device-status" id="statusContainer">
<span id="dynamicStatus">--</span>
</div>

<div class="toggle-wrapper">
<input type="checkbox" id="deviceToggle">
<label for="deviceToggle" class="toggle-switch"></label>
</div>

<div class="cloud-badge">
<i class="fas fa-cloud"></i> cloud · realtime
</div>

</div>
</div>

<script>
(function(){

const SERVER = "https://opposite-eventually-niagara-allocated.trycloudflare.com";

const toggle = document.getElementById("deviceToggle");
const statusText = document.getElementById("dynamicStatus");
const card = document.querySelector(".device-card");

let currentState = false;
let busy = false;

// ---------- GET STATE ----------
async function fetchState(){

if(busy) return;

try{

const res = await fetch(SERVER + "/status");
const data = await res.json();

if(typeof data.state === "boolean"){

currentState = data.state;
toggle.checked = currentState;

updateUI(currentState);

}

}catch(e){
console.log("Fetch error",e);
}

}

// ---------- SEND STATE ----------
async function sendState(state){

if(busy) return;
busy = true;

try{

const res = await fetch(SERVER + "/status",{
method:"POST",
headers:{ "Content-Type":"application/json"},
body:JSON.stringify({state:state})
});

const data = await res.json();

if(typeof data.state === "boolean"){
currentState = data.state;
}

}catch(e){
console.log("Send error",e);
}

busy = false;

}

// ---------- UI ----------
function updateUI(isOn){

statusText.innerText = isOn ? "on" : "off";

if(isOn){
card.style.boxShadow="0 0 40px #2ce09a";
}else{
card.style.boxShadow="0 0 30px #ff7060";
}

}

// ---------- TOGGLE ----------
toggle.addEventListener("change",()=>{

const newState = toggle.checked;

updateUI(newState);

sendState(newState);

});

// ---------- AUTO REFRESH ----------
setInterval(fetchState,2000);

// initial
fetchState();

})();
</script>

</body>
</html>
